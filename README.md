# GitHub PR Whisperer

This project is a Go application designed to interact with the GitHub API to whisper to the PR if it contains rules violations.

Moto: "Whisper to the PR, don't shout!"

## Environment Variables

The following environment variables need to be set for the application to function correctly:

- `GITHUB_TOKEN`: Autogenerated GitHub token that can be taken from the action.
- `GH_AUTH_TOKEN`: Your GitHub authentication token. Should be a personal access token with the `repo` scope.
- `GITHUB_REPOSITORY`: The name of the repository.
- `GITHUB_PULL_REQUEST_NUMBER`: The pull request number.

## Usage

### Running Locally

1. Clone the repository:
    ```sh
    git clone httpshttps://api.github.com/mptooling/pr-whisper.git
    cd pr-whisper
    ```

2. Set the required environment variables:
    ```sh
    export GITHUB_TOKEN=your_github_token
    export GH_AUTH_TOKEN=github_auth_token
    export GITHUB_OWNER=your_github_owner
    export GITHUB_REPOSITORY=your_github_repository
    export GITHUB_PULL_REQUEST_NUMBER=your_pull_request_number
    ```

3. Build and run the application:
    ```sh
    go build -o prwhisperer
    ./prwhisperer
    ```

### Running with Docker

1. Build the Docker image:
    ```sh
    docker build -t prwhisperer .
    ```

2. Run the Docker container:
    ```sh
    docker run -e GITHUB_TOKEN=your_github_token \
               -e GH_AUTH_TOKEN=your_github_auth_token \
               -e GITHUB_OWNER=your_github_owner \
               -e GITHUB_REPOSITORY=your_github_repository \
               -e GITHUB_PULL_REQUEST_NUMBER=your_pull_request_number \
               prwhisperer
    ```

### Using as a GitHub Action

1. Create a `.github/workflows/pr-whisperer.yml` file in your repository with the following content:
    ```yaml
    name: PR Whisperer

    on:
      pull_request:
        types: [opened, synchronize, reopened]

    jobs:
      pr-whisperer:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout repository
          uses: actions/checkout@v2

        - name: Set up Go
          uses: actions/setup-go@v2
          with:
            go-version: 1.23

        - name: Build and run PR Whisperer
          uses: mptooling/pr-whisper@main # Not released yet
          env:
            GITHUB_TOKEN: ${{ github.token }}
            GH_AUTH_TOKEN: ${{ secrets.PAT }} # Requires secret named PAT
            GITHUB_SHA: ${{ github.sha }}
            GITHUB_REPOSITORY: ${{ github.repository }}
            GITHUB_PULL_REQUEST_NUMBER: ${{ github.event.number }}
    ```

## License

This project is licensed under the MIT License.